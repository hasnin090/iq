# 🧪 دليل اختبار نظام المحاسبة العربي مع Supabase

هذا الدليل يوضح كيفية اختبار نظام المحاسبة العربي محلياً قبل نشره في الإنتاج.

## 📋 المتطلبات الأساسية

1. **Node.js 18+** مثبت على النظام
2. **حساب Supabase** مجاني أو مدفوع
3. **مشروع Supabase** جديد أو موجود

## 🔧 الإعداد الأولي

### الخطوة 1: إنشاء مشروع Supabase

1. اذهب إلى [supabase.com](https://supabase.com)
2. سجل الدخول أو أنشئ حساب جديد
3. انقر على "New Project"
4. اختر اسم المشروع: `arabic-accounting-system`
5. اختر كلمة مرور قوية لقاعدة البيانات
6. اختر المنطقة الأقرب لك (مثل: `ap-southeast-1`)

### الخطوة 2: الحصول على مفاتيح المشروع

1. من لوحة تحكم Supabase، اذهب إلى **Settings** → **API**
2. انسخ:
   - **Project URL** (مثل: `https://xyz.supabase.co`)
   - **anon/public key** (يبدأ بـ `eyJ...`)
   - **service_role key** (يبدأ بـ `eyJ...`) - للمشاعمين فقط

### الخطوة 3: إعداد ملف البيئة

شغّل سكريپت إعداد البيئة:

```bash
npm run setup:env
```

أو أنشئ ملف `.env` يدوياً:

```env
# Supabase Configuration
VITE_SUPABASE_URL=https://your-project-ref.supabase.co
VITE_SUPABASE_ANON_KEY=your-anon-key-here
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key

# Application Configuration
VITE_APP_NAME=نظام المحاسبة العربي - شركة طريق العامرة
NODE_ENV=development
```

## 🧪 اختبارات متاحة

### 1. اختبار الاتصال فقط

```bash
npm run test:connection
```

يقوم بـ:
- ✅ فحص متغيرات البيئة
- ✅ اختبار الاتصال بـ Supabase
- ✅ التحقق من صحة المفاتيح

### 2. اختبار المخطط فقط

```bash
npm run test:schema
```

يقوم بـ:
- ✅ تشغيل مخطط قاعدة البيانات
- ✅ إنشاء جميع الجداول (21 جدول)
- ✅ إنشاء الفهارس وسياسات الأمان
- ✅ إدراج البيانات الأولية

### 3. الاختبار الشامل

```bash
npm run test:supabase
```

يقوم بـ:
- ✅ جميع اختبارات الاتصال
- ✅ تشغيل المخطط كاملاً
- ✅ اختبار جميع الجداول
- ✅ اختبار البيانات الأولية
- ✅ إدراج بيانات تجريبية

## 📊 النتائج المتوقعة

### نتيجة ناجحة:
```
🎯 النتيجة الإجمالية: 5/5 اختبار نجح
🎉 تهانينا! نظام المحاسبة العربي جاهز للاستخدام!
```

### نتيجة فاشلة:
```
🎯 النتيجة الإجمالية: 2/5 اختبار نجح
⚠️ يحتاج النظام إلى مراجعة قبل الاستخدام في الإنتاج
```

## 🗃️ الجداول المنشأة

سيتم إنشاء 21 جدول:

| الجدول | الوصف |
|--------|--------|
| `profiles` | ملفات المستخدمين |
| `projects` | المشاريع |
| `user_roles` | أدوار المستخدمين |
| `expense_types` | أنواع المصروفات |
| `employees` | الموظفين |
| `transactions` | المعاملات المالية |
| `documents` | المستندات |
| `receivables` | المستحقات |
| `completed_works` | الأعمال المكتملة |
| `settings` | إعدادات النظام |
| `notifications` | الإشعارات |
| `activity_logs` | سجل الأنشطة |
| `ledger_entries` | القيود المحاسبية |
| `budget_tracking` | تتبع الميزانية |
| `custom_reports` | التقارير المخصصة |
| `whatsapp_messages` | رسائل واتساب |
| `backups` | النسخ الاحتياطية |
| وغيرها... | ... |

## 🔒 الأمان

### Row-Level Security (RLS)
- ✅ مفعل على جميع الجداول
- ✅ سياسات أمان متقدمة
- ✅ تحكم في صلاحيات المستخدمين

### المصادقة
- ✅ نظام مصادقة Supabase
- ✅ إدارة الجلسات
- ✅ حماية API

## 📈 البيانات الأولية

### أنواع المصروفات (14 نوع):
- مصروف عام
- راتب موظف
- إيجار
- مواصلات
- اتصالات
- كهرباء ومياه
- مواد البناء
- معدات
- مكتبية
- تسويق
- ضرائب
- تأمين
- صيانة
- وقود

### إعدادات النظام (20 إعداد):
- اسم الشركة: "شركة طريق العامرة"
- العملة: "IQD" (دينار عراقي)
- اللغة: العربية
- المنطقة الزمنية: "Asia/Baghdad"
- وغيرها...

## 🚨 استكشاف الأخطاء

### خطأ: "مفاتيح Supabase مفقودة"
**الحل:**
1. تأكد من وجود ملف `.env`
2. تأكد من صحة قيم `VITE_SUPABASE_URL` و `VITE_SUPABASE_ANON_KEY`

### خطأ: "خطأ في الاتصال"
**الحل:**
1. تأكد من اتصال الإنترنت
2. تأكد من صحة URL الخاص بـ Supabase
3. تأكد من أن المشروع لم يتم إيقافه

### خطأ: "غير مصرح"
**الحل:**
1. تأكد من صحة anon key
2. تأكد من أن المشروع نشط
3. تحقق من إعدادات RLS في Supabase

### خطأ: "Service Key مطلوب"
**الحل:**
1. احصل على service_role key من Supabase Dashboard
2. أضفه إلى ملف `.env`
3. أو شغّل المخطط يدوياً من SQL Editor

## 🔄 تشغيل المخطط يدوياً

إذا فشل التشغيل التلقائي:

1. اذهب إلى **Supabase Dashboard**
2. انقر على **SQL Editor**
3. انسخ محتوى ملف `supabase-schema.sql`
4. الصقه في المحرر
5. انقر **RUN**

## 📞 الدعم

إذا واجهت أي مشاكل:

1. تأكد من اتباع جميع الخطوات
2. تحقق من سجل الأخطاء في الكونسول
3. راجع [وثائق Supabase](https://supabase.com/docs)

---

**شركة طريق العامرة - نظام المحاسبة العربي**  
*تم إنشاؤه بواسطة GitHub Copilot - يوليو 2025*
